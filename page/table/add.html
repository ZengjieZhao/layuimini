<div class="layuimini-main">
    <!-- 
                    { field: 'id', width: 80, title: 'ID', sort: true },
                { field: 'username', width: 80, title: '姓名' },
                { field: 'sex', width: 80, title: '性别', sort: true },
                { field: 'phone', width: 130, title: '电话' },
                { field: 'cardid', title: '卡号', width: 150 },
                { field: 'college', width: 100, title: '学院', sort: true },
                { field: 'major', width: 100, title: '专业', sort: true },
                { field: 'grade', width: 80, title: '年级' },
                { field: 'class', width: 80, title: '班级', sort: true },
 -->
    <div class="layui-form layuimini-form">
        <div class="layui-form-item">
            <label class="layui-form-label required">姓名</label>
            <div class="layui-input-block">
                <input type="text" id="username" name="username" lay-verify="required" lay-reqtext="姓名不能为空"
                    placeholder="请输入用户名" value="test" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label required">卡号</label>
            <div class="layui-input-block">
                <input type="text" name="cardid" lay-verify="required" lay-reqtext="卡号不能为空" placeholder="请输入卡号" value=""
                    class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-normal" lay-submit lay-filter="saveBtn">确认</button>
            </div>
        </div>
    </div>
</div>
<script>
    layui.use(['form', 'table'], function () {
        var form = layui.form,
            layer = layui.layer,
            table = layui.table,
            $ = layui.$;

        /**
         * 初始化表单，要加上，不然刷新部分组件可能会不加载
         */
        form.render();

        // 当前弹出层，防止ID被覆盖
        var parentIndex = layer.index;

        //监听提交
        form.on('submit(saveBtn)', function (data) {
            $.ajax(
                {
                    url: "http://127.0.0.1:8098/user",
                    method: "post",
                    dataType: 'json',
                    contentType: 'application/json;charset=UTF-8',
                    data: JSON.stringify(data.field),
                    success: function (res) {
                        console.log('success');
                        console.log(res);
                        var index = layer.msg('添加成功!', function () {
                            // 关闭弹出层
                            layer.close(index);
                            layer.close(parentIndex);
                            //执行重载
                            table.reload('currentTableId', {
                                page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                                , where: {
                                }
                            });
                        });
                    },
                    error: function (res) {
                        console.log('error');
                        console.log(res);
                        var index = layer.msg('添加失败!', function () {
                            // 关闭弹出层
                            layer.close(index);
                            layer.close(parentIndex);
                            //执行重载
                            table.reload('currentTableId', {
                                page: {
                                    curr: 1 //重新从第 1 页开始
                                }
                                , where: {
                                }
                            });
                        });
                    }
                }
            );

            return false;
        });

    });
</script>